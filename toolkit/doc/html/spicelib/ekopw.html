
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<HTML>

<HEAD>
   <TITLE>ekopw</TITLE>
</HEAD>

<BODY style="color: rgb(0, 0, 0); background-color: rgb(255, 255, 255);">
<A name="TOP"></A>

<table style="text-align: left; margin-left: auto; margin-right: auto; width: 800px;"
 border="0" cellpadding="5" cellspacing="2">
  <tbody>
    <tr><td>
<div align="center">
Index of Functions: 
<A HREF="index.html#A">A</A>&nbsp;
<A HREF="index.html#B">B</A>&nbsp;
<A HREF="index.html#C">C</A>&nbsp;
<A HREF="index.html#D">D</A>&nbsp;
<A HREF="index.html#E">E</A>&nbsp;
<A HREF="index.html#F">F</A>&nbsp;
<A HREF="index.html#G">G</A>&nbsp;
<A HREF="index.html#H">H</A>&nbsp;
<A HREF="index.html#I">I</A>&nbsp;
<A HREF="index.html#J">J</A>&nbsp;
<A HREF="index.html#K">K</A>&nbsp;
<A HREF="index.html#L">L</A>&nbsp;
<A HREF="index.html#M">M</A>&nbsp;
<A HREF="index.html#N">N</A>&nbsp;
<A HREF="index.html#O">O</A>&nbsp;
<A HREF="index.html#P">P</A>&nbsp;
<A HREF="index.html#Q">Q</A>&nbsp;
<A HREF="index.html#R">R</A>&nbsp;
<A HREF="index.html#S">S</A>&nbsp;
<A HREF="index.html#T">T</A>&nbsp;
<A HREF="index.html#U">U</A>&nbsp;
<A HREF="index.html#V">V</A>&nbsp;
<A HREF="index.html#W">W</A>&nbsp;
<A HREF="index.html#X">X</A>&nbsp;
</div>
</td></tr>

    <tr>
      <td style="background-color: rgb(153, 153, 153); vertical-align: middle; text-align: center;">
      <div align="right"> 
      <small><small><a href="index.html">Index Page</a></small></small>
      </div>
      <b>ekopw</b></td>
    </tr>
    

    <tr>
      <td style="vertical-align: top;">

       <br>
       <div align="left"><b>Table of contents</b></div>
       <table style="text-align: left; width: 60%; margin-left: auto; margin-right: auto;"
       border="0" cellspacing="2" cellpadding="2">
        <tbody>
          <tr>
            <td style="width: 33%; text-align: center;">
              <a href="#Procedure">Procedure<br></a>
              <a href="#Abstract">Abstract<br></a>
              <a href="#Required_Reading">Required_Reading<br></a>
              <a href="#Keywords">Keywords<br></a>
              <a href="#Declarations">Declarations<br></a>
              <a href="#Brief_I/O">Brief_I/O<br></a>

              </td>
              <td style="vertical-align: top; width: 33%; text-align: center;">              <a href="#Detailed_Input">Detailed_Input<br></a>
              <a href="#Detailed_Output">Detailed_Output<br></a>
              <a href="#Parameters">Parameters<br></a>
              <a href="#Exceptions">Exceptions<br></a>
              <a href="#Files">Files<br></a>
              <a href="#Particulars">Particulars<br></a>

              </td>
              <td style="vertical-align: top; width: 33%; text-align: center;">              <big><b><a href="#Examples">Examples<br></a></b></big>
              <a href="#Restrictions">Restrictions<br></a>
              <a href="#Literature_References">Literature_References<br></a>
              <a href="#Author_and_Institution">Author_and_Institution<br></a>
              <a href="#Version">Version<br></a>
            </td>
          </tr>
        </tbody>
</table>
<hr>

<h4><a name="Procedure">Procedure</a></h4>
<PRE>
     EKOPW ( EK, open file for writing )

     SUBROUTINE EKOPW ( FNAME, HANDLE )
</PRE>
<h4><a name="Abstract">Abstract</a></h4>
<PRE>
     Open an existing E-kernel file for writing.
</PRE>
<h4><a name="Required_Reading">Required_Reading</a></h4>
<PRE>
     <a href="../req/ek.html">EK</a>
</PRE>
<h4><a name="Keywords">Keywords</a></h4>
<PRE>
     EK
     FILES
     UTILITY
</PRE>
<h4><a name="Declarations">Declarations</a></h4>
<PRE>
     IMPLICIT NONE

     CHARACTER*(*)         FNAME
     INTEGER               HANDLE
</PRE>
<h4><a name="Brief_I/O">Brief_I/O</a></h4>
<PRE>
     VARIABLE  I/O  DESCRIPTION
     --------  ---  --------------------------------------------------
     FNAME      I   Name of EK file.
     HANDLE     O   Handle attached to EK file.
</PRE>
<h4><a name="Detailed_Input">Detailed_Input</a></h4>
<PRE>
     FNAME    is the name of an existing E-kernel file to be
              opened for write access.
</PRE>
<h4><a name="Detailed_Output">Detailed_Output</a></h4>
<PRE>
     HANDLE   is the DAS file handle of the EK designate by
              FNAME. This handle is used to identify the file
              to other EK routines.
</PRE>
<h4><a name="Parameters">Parameters</a></h4>
<PRE>
     FTSIZE   is the maximum number of DAS files that a user can
              have open simultaneously. This includes any files used
              by the DAS system.

              See the include file das.inc for the actual value of
              this parameter.
</PRE>
<h4><a name="Exceptions">Exceptions</a></h4>
<PRE>
     1)  If the indicated file cannot be opened, an error is signaled
         by a routine in the call tree of this routine.

     2)  If the indicated file has the wrong architecture version, an
         error is signaled by a routine in the call tree of this
         routine.

     3)  If an I/O error occurs while reading or writing the indicated
         file, the error is signaled by a routine in the call tree of
         this routine.
</PRE>
<h4><a name="Files">Files</a></h4>
<PRE>
     See the EK Required Reading ek.req for a discussion of the EK file
     format.
</PRE>
<h4><a name="Particulars">Particulars</a></h4>
<PRE>
     This routine should be used to open an EK existing file for write
     access.

     Opening an EK file with this routine makes the EK accessible to
     the following SPICELIB EK access routines, all of which modify
     the target EK file:

        Begin segment:

           <a href="ekbseg.html">EKBSEG</a>

        Append, insert, delete records:

           <a href="ekappr.html">EKAPPR</a>
           <a href="ekinsr.html">EKINSR</a>
           <a href="ekdelr.html">EKDELR</a>

        Add column entries:

           <a href="ekacec.html">EKACEC</a>
           <a href="ekaced.html">EKACED</a>
           <a href="ekacei.html">EKACEI</a>

        Update existing column entries:

           <a href="ekucec.html">EKUCEC</a>
           <a href="ekuced.html">EKUCED</a>
           <a href="ekucei.html">EKUCEI</a>

        Execute fast write:

           <a href="ekifld.html">EKIFLD</a>
           <a href="ekffld.html">EKFFLD</a>
           <a href="ekaclc.html">EKACLC</a>
           <a href="ekacld.html">EKACLD</a>
           <a href="ekacli.html">EKACLI</a>

     An EK opened for write access is also accessible for reading.
     The file may be accessed by the SPICELIB EK readers

           <a href="ekrcec.html">EKRCEC</a>
           <a href="ekrced.html">EKRCED</a>
           <a href="ekrcei.html">EKRCEI</a>

        and summary routines:

           <a href="eknseg.html">EKNSEG</a>
           <a href="ekssum.html">EKSSUM</a>


     An EK opened for write access cannot be queried. To make an EK
     available to the EK query system, the file must be loaded via
     <a href="furnsh.html">FURNSH</a> or <a href="eklef.html">EKLEF</a>, rather than by this routine. See the EK Required
     Reading for further information.
</PRE>
<h4><a name="Examples">Examples</a></h4>
<PRE>
     The numerical results shown for this example may differ across
     platforms. The results depend on the SPICE kernels used as
     input, the compiler and supporting libraries, and the machine
     specific arithmetic implementation.

     1) The following program demonstrates how to create a new EK and
        add data to a character column in a given record within the
        file, how to re-open the file for write access and update the
        data, and how to read the data from it.


        Example code begins here.


              PROGRAM EKOPW_EX1
              IMPLICIT NONE

        C
        C     Include the EK Column Name Size (CNAMSZ)
        C
              INCLUDE 'ekcnamsz.inc'

        C
        C     Local constants.
        C
              CHARACTER*(*)         EKNAME
              PARAMETER           ( EKNAME = 'ekopw_ex1.bdb' )

              CHARACTER*(*)         IFNAME
              PARAMETER           ( IFNAME = 'Test EK'  )

              CHARACTER*(*)         TABLE
              PARAMETER           ( TABLE  = 'CHR_DATA' )

              INTEGER               CVLEN
              PARAMETER           ( CVLEN  = 9  )

              INTEGER               DECLEN
              PARAMETER           ( DECLEN = 200 )

              INTEGER               MAXVAL
              PARAMETER           ( MAXVAL = 4  )

              INTEGER               NCOLS
              PARAMETER           ( NCOLS  = 2  )

              INTEGER               NROWS
              PARAMETER           ( NROWS  = 6  )

              INTEGER               NRESVC
              PARAMETER           ( NRESVC = 0  )

        C
        C     Local variables
        C
              CHARACTER*(DECLEN)    CDECLS ( NCOLS  )
              CHARACTER*(CNAMSZ)    CNAMES ( NCOLS  )
              CHARACTER*(CVLEN)     CVALS  ( MAXVAL )

              INTEGER               HANDLE
              INTEGER               I
              INTEGER               J
              INTEGER               NVALS
              INTEGER               RECNO
              INTEGER               SEGNO

              LOGICAL               ISNULL


        C
        C     Open a new EK file.  For simplicity, we won't
        C     reserve space for the comment area, so the
        C     number of reserved comment characters is zero.
        C     The constant IFNAME is the internal file name.
        C
              CALL <a href="ekopn.html">EKOPN</a> ( EKNAME, IFNAME, NRESVC, HANDLE )

        C
        C     Set up the table and column names and declarations
        C     for the CHR_DATA segment.  We'll index all of
        C     the columns.
        C
              CNAMES(1) =  'CHR_COL_1'
              CDECLS(1) =  'DATATYPE = CHARACTER*(*), '
             .       //    'INDEXED = TRUE, NULLS_OK = TRUE'

              CNAMES(2) =  'CHR_COL_2'
              CDECLS(2) =  'DATATYPE = CHARACTER*(9), '
             .       //    'SIZE = VARIABLE, NULLS_OK = TRUE'

        C
        C     Start the segment.
        C
              CALL <a href="ekbseg.html">EKBSEG</a> ( HANDLE, TABLE,  NCOLS,
             .              CNAMES, CDECLS, SEGNO )

              DO I = 0, NROWS-1

                 CALL <a href="ekappr.html">EKAPPR</a> ( HANDLE, SEGNO, RECNO )

                 ISNULL = ( I .EQ. 1 )

                 CALL <a href="intstr.html">INTSTR</a> ( I, CVALS(1) )
                 CALL <a href="ekacec.html">EKACEC</a> ( HANDLE, SEGNO, RECNO, CNAMES(1),
             .                 1,      CVALS, ISNULL           )

        C
        C        Array-valued columns follow.
        C
                 CALL <a href="intstr.html">INTSTR</a> ( 10*I,     CVALS(1) )
                 CALL <a href="intstr.html">INTSTR</a> ( 10*I + 1, CVALS(2) )
                 CALL <a href="intstr.html">INTSTR</a> ( 10*I + 2, CVALS(3) )
                 CALL <a href="intstr.html">INTSTR</a> ( 10*I + 3, CVALS(4) )
                 CALL <a href="ekacec.html">EKACEC</a> ( HANDLE, SEGNO, RECNO, CNAMES(2),
             .                 4,      CVALS, ISNULL           )

              END DO

        C
        C     End the file.
        C
              CALL <a href="ekcls.html">EKCLS</a> ( HANDLE )

        C
        C     Open the EK for write access.
        C
              CALL <b>EKOPW</b> ( EKNAME, HANDLE )

        C
        C     Negate the values in the even-numbered records
        C     using the update routines.
        C
              DO I = 1, NROWS, 2

                 RECNO  = I+1

                 ISNULL = ( I .EQ. 1 )

                 CALL <a href="intstr.html">INTSTR</a> ( -I, CVALS(1) )
                 CALL <a href="ekucec.html">EKUCEC</a> ( HANDLE, SEGNO, RECNO, CNAMES(1),
             .                 1,      CVALS, ISNULL           )

        C
        C        Array-valued columns follow.
        C
                 CALL <a href="intstr.html">INTSTR</a> ( -10*I,       CVALS(1) )
                 CALL <a href="intstr.html">INTSTR</a> ( -(10*I + 1), CVALS(2) )
                 CALL <a href="intstr.html">INTSTR</a> ( -(10*I + 2), CVALS(3) )
                 CALL <a href="intstr.html">INTSTR</a> ( -(10*I + 3), CVALS(4) )
                 CALL <a href="ekucec.html">EKUCEC</a> ( HANDLE, SEGNO, RECNO, CNAMES(2),
             .                 4,      CVALS, ISNULL           )

              END DO

        C
        C     Close the file.
        C
              CALL <a href="ekcls.html">EKCLS</a> ( HANDLE )

        C
        C     Open the created file. Show the values added.
        C
              CALL <a href="ekopr.html">EKOPR</a> ( EKNAME, HANDLE )

              DO I = 1, NROWS

                 CALL <a href="ekrcec.html">EKRCEC</a> ( HANDLE, SEGNO, I,     CNAMES(1),
             .                 NVALS,  CVALS, ISNULL           )

                 IF ( .NOT. ISNULL ) THEN

                    WRITE(*,*) 'Data from column: ', CNAMES(1)
                    WRITE(*,*) '   record number: ', I
                    WRITE(*,*) '   values       : ',
             .                                ( CVALS(J), J=1,NVALS )
                    WRITE(*,*) ' '

                 ELSE

                    WRITE(*,*) 'Record ', I, 'flag is NULL.'
                    WRITE(*,*) ' '

                 END IF

        C
        C        Array-valued columns follow.
        C
                 CALL <a href="ekrcec.html">EKRCEC</a> ( HANDLE, SEGNO, I,     CNAMES(2),
             .                 NVALS,  CVALS, ISNULL           )

                 IF ( .NOT. ISNULL ) THEN

                    WRITE(*,*) 'Data from column: ', CNAMES(2)
                    WRITE(*,*) '   record number: ', I
                    WRITE(*,*) '   values       : ',
             .                                ( CVALS(J), J=1,NVALS )
                    WRITE(*,*) ' '

                 END IF

              END DO

        C
        C     Close the file.
        C
              CALL <a href="ekcls.html">EKCLS</a> ( HANDLE )

              END


        When this program was executed on a Mac/Intel/gfortran/64-bit
        platform, the output was:


         Data from column: CHR_COL_1
            record number:            1
            values       : 0

         Data from column: CHR_COL_2
            record number:            1
            values       : 0        1        2        3

         Record            2 flag is NULL.

         Data from column: CHR_COL_1
            record number:            3
            values       : 2

         Data from column: CHR_COL_2
            record number:            3
            values       : 20       21       22       23

         Data from column: CHR_COL_1
            record number:            4
            values       : -3

         Data from column: CHR_COL_2
            record number:            4
            values       : -30      -31      -32      -33

         Data from column: CHR_COL_1
            record number:            5
            values       : 4

         Data from column: CHR_COL_2
            record number:            5
            values       : 40       41       42       43

         Data from column: CHR_COL_1
            record number:            6
            values       : -5

         Data from column: CHR_COL_2
            record number:            6
            values       : -50      -51      -52      -53


        Note that the second record does not appear due to setting the
        ISNULL flag to .TRUE. for that record. The odd value record
        numbers have negative values as a result of the update calls.

        After run completion, a new EK exists in the output directory.
</PRE>
<h4><a name="Restrictions">Restrictions</a></h4>
<PRE>
     1)  No more than FTSIZE DAS files may be opened simultaneously.
         See the include file das.inc for the value of FTSIZE.
</PRE>
<h4><a name="Literature_References">Literature_References</a></h4>
<PRE>
     None.
</PRE>
<h4><a name="Author_and_Institution">Author_and_Institution</a></h4>
<PRE>
     N.J. Bachman       (JPL)
     J. Diaz del Rio    (ODC Space)
</PRE>
<h4><a name="Version">Version</a></h4>
<PRE>
    SPICELIB Version 1.1.0, 06-JUL-2021 (JDR)

        Added IMPLICIT NONE statement.

        Edited the header to comply with NAIF standard. Added complete
        code example.

        Updated exception #1 to remove the statement about deleting the
        opened file upon failure.

        Updated &quot;fast write&quot; list of API, which was listing the wrong
        APIs for adding data.

        Added FTSIZE parameter description. Updated index entry.

    SPICELIB Version 1.0.1, 09-JAN-2002 (NJB)

        Documentation change: instances of the phrase &quot;fast load&quot;
        were replaced with &quot;fast write.&quot;

    SPICELIB Version 1.0.0, 26-SEP-1995 (NJB)</PRE>
<h4>Link to routine EKOPW source file <a href='../../../src/spicelib/ekopw.f'>ekopw.f</a> </h4>

      </td>
    </tr>
  </tbody>
</table>

   <pre>Fri Dec 31 18:36:19 2021</pre>

</body>
</html>

