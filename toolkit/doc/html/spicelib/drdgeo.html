
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<HTML>

<HEAD>
   <TITLE>drdgeo</TITLE>
</HEAD>

<BODY style="color: rgb(0, 0, 0); background-color: rgb(255, 255, 255);">
<A name="TOP"></A>

<table style="text-align: left; margin-left: auto; margin-right: auto; width: 800px;"
 border="0" cellpadding="5" cellspacing="2">
  <tbody>
    <tr><td>
<div align="center">
Index of Functions: 
<A HREF="index.html#A">A</A>&nbsp;
<A HREF="index.html#B">B</A>&nbsp;
<A HREF="index.html#C">C</A>&nbsp;
<A HREF="index.html#D">D</A>&nbsp;
<A HREF="index.html#E">E</A>&nbsp;
<A HREF="index.html#F">F</A>&nbsp;
<A HREF="index.html#G">G</A>&nbsp;
<A HREF="index.html#H">H</A>&nbsp;
<A HREF="index.html#I">I</A>&nbsp;
<A HREF="index.html#J">J</A>&nbsp;
<A HREF="index.html#K">K</A>&nbsp;
<A HREF="index.html#L">L</A>&nbsp;
<A HREF="index.html#M">M</A>&nbsp;
<A HREF="index.html#N">N</A>&nbsp;
<A HREF="index.html#O">O</A>&nbsp;
<A HREF="index.html#P">P</A>&nbsp;
<A HREF="index.html#Q">Q</A>&nbsp;
<A HREF="index.html#R">R</A>&nbsp;
<A HREF="index.html#S">S</A>&nbsp;
<A HREF="index.html#T">T</A>&nbsp;
<A HREF="index.html#U">U</A>&nbsp;
<A HREF="index.html#V">V</A>&nbsp;
<A HREF="index.html#W">W</A>&nbsp;
<A HREF="index.html#X">X</A>&nbsp;
</div>
</td></tr>

    <tr>
      <td style="background-color: rgb(153, 153, 153); vertical-align: middle; text-align: center;">
      <div align="right"> 
      <small><small><a href="index.html">Index Page</a></small></small>
      </div>
      <b>drdgeo</b></td>
    </tr>
    

    <tr>
      <td style="vertical-align: top;">

       <br>
       <div align="left"><b>Table of contents</b></div>
       <table style="text-align: left; width: 60%; margin-left: auto; margin-right: auto;"
       border="0" cellspacing="2" cellpadding="2">
        <tbody>
          <tr>
            <td style="width: 33%; text-align: center;">
              <a href="#Procedure">Procedure<br></a>
              <a href="#Abstract">Abstract<br></a>
              <a href="#Required_Reading">Required_Reading<br></a>
              <a href="#Keywords">Keywords<br></a>
              <a href="#Declarations">Declarations<br></a>
              <a href="#Brief_I/O">Brief_I/O<br></a>

              </td>
              <td style="vertical-align: top; width: 33%; text-align: center;">              <a href="#Detailed_Input">Detailed_Input<br></a>
              <a href="#Detailed_Output">Detailed_Output<br></a>
              <a href="#Parameters">Parameters<br></a>
              <a href="#Exceptions">Exceptions<br></a>
              <a href="#Files">Files<br></a>
              <a href="#Particulars">Particulars<br></a>

              </td>
              <td style="vertical-align: top; width: 33%; text-align: center;">              <big><b><a href="#Examples">Examples<br></a></b></big>
              <a href="#Restrictions">Restrictions<br></a>
              <a href="#Literature_References">Literature_References<br></a>
              <a href="#Author_and_Institution">Author_and_Institution<br></a>
              <a href="#Version">Version<br></a>
            </td>
          </tr>
        </tbody>
</table>
<hr>

<h4><a name="Procedure">Procedure</a></h4>
<PRE>
     DRDGEO ( Derivative of rectangular w.r.t. geodetic )

     SUBROUTINE DRDGEO ( LON, LAT, ALT, RE, F, JACOBI )
</PRE>
<h4><a name="Abstract">Abstract</a></h4>
<PRE>
     Compute the Jacobian matrix of the transformation from geodetic
     to rectangular coordinates.
</PRE>
<h4><a name="Required_Reading">Required_Reading</a></h4>
<PRE>
     None.
</PRE>
<h4><a name="Keywords">Keywords</a></h4>
<PRE>
     COORDINATES
     DERIVATIVES
     MATRIX
</PRE>
<h4><a name="Declarations">Declarations</a></h4>
<PRE>
     IMPLICIT NONE

     DOUBLE PRECISION      LON
     DOUBLE PRECISION      LAT
     DOUBLE PRECISION      ALT
     DOUBLE PRECISION      RE
     DOUBLE PRECISION      F
     DOUBLE PRECISION      JACOBI ( 3, 3 )
</PRE>
<h4><a name="Brief_I/O">Brief_I/O</a></h4>
<PRE>
     VARIABLE  I/O  DESCRIPTION
     --------  ---  --------------------------------------------------
     LON        I   Geodetic longitude of point (radians).
     LAT        I   Geodetic latitude of point (radians).
     ALT        I   Altitude of point above the reference spheroid.
     RE         I   Equatorial radius of the reference spheroid.
     F          I   Flattening coefficient.
     JACOBI     O   Matrix of partial derivatives.
</PRE>
<h4><a name="Detailed_Input">Detailed_Input</a></h4>
<PRE>
     LON      is the geodetic longitude of point (radians).

     LAT      is the geodetic latitude  of point (radians).

     ALT      is the altitude of point above the reference spheroid.

     RE       is the equatorial radius of the reference spheroid.

     F        is the flattening coefficient = (RE-RP) / RE,  where
              RP is the polar radius of the spheroid. (More
              importantly RP = RE*(1-F).)
</PRE>
<h4><a name="Detailed_Output">Detailed_Output</a></h4>
<PRE>
     JACOBI   is the matrix of partial derivatives of the conversion
              between geodetic and rectangular coordinates. It
              has the form

                 .-                             -.
                 |  DX/DLON   DX/DLAT  DX/DALT   |
                 |  DY/DLON   DY/DLAT  DY/DALT   |
                 |  DZ/DLON   DZ/DLAT  DZ/DALT   |
                 `-                             -'

              evaluated at the input values of LON, LAT and ALT.

              The formulae for computing X, Y, and Z from
              geodetic coordinates are given below.

                 X = [ALT +          RE/G(LAT,F)]*COS(LON)*COS(LAT)
                 Y = [ALT +          RE/G(LAT,F)]*SIN(LON)*COS(LAT)
                 Z = [ALT + RE*(1-F)**2/G(LAT,F)]*         SIN(LAT)

              where

                 RE is the polar radius of the reference spheroid.

                 F  is the flattening factor (the polar radius is
                    obtained by multiplying the equatorial radius by
                    1-F).

                 G( LAT, F ) is given by

                    sqrt ( cos(lat)**2 + (1-f)**2 * sin(lat)**2 )
</PRE>
<h4><a name="Parameters">Parameters</a></h4>
<PRE>
     None.
</PRE>
<h4><a name="Exceptions">Exceptions</a></h4>
<PRE>
     1)  If the flattening coefficient is greater than or equal to
         one, the error SPICE(VALUEOUTOFRANGE) is signaled.

     2)  If the equatorial radius is non-positive, the error
         SPICE(BADRADIUS) is signaled.
</PRE>
<h4><a name="Files">Files</a></h4>
<PRE>
     None.
</PRE>
<h4><a name="Particulars">Particulars</a></h4>
<PRE>
     It is often convenient to describe the motion of an object in
     the geodetic coordinate system. However, when performing
     vector computations its hard to beat rectangular coordinates.

     To transform states given with respect to geodetic coordinates
     to states with respect to rectangular coordinates, one makes use
     of the Jacobian of the transformation between the two systems.

     Given a state in geodetic coordinates

          ( lon, lat, alt, dlon, dlat, dalt )

     the velocity in rectangular coordinates is given by the matrix
     equation:

                    t          |                                  t
        (dx, dy, dz)   = JACOBI|              * (dlon, dlat, dalt)
                               |(lon,lat,alt)


     This routine computes the matrix

              |
        JACOBI|
              |(lon,lat,alt)
</PRE>
<h4><a name="Examples">Examples</a></h4>
<PRE>
     The numerical results shown for this example may differ across
     platforms. The results depend on the SPICE kernels used as
     input, the compiler and supporting libraries, and the machine
     specific arithmetic implementation.

     1) Find the geodetic state of the earth as seen from
        Mars in the IAU_MARS reference frame at January 1, 2005 TDB.
        Map this state back to rectangular coordinates as a check.

        Use the meta-kernel shown below to load the required SPICE
        kernels.


           KPL/MK

           File name: drdgeo_ex1.tm

           This meta-kernel is intended to support operation of SPICE
           example programs. The kernels shown here should not be
           assumed to contain adequate or correct versions of data
           required by SPICE-based user applications.

           In order for an application to use this meta-kernel, the
           kernels referenced here must be present in the user's
           current working directory.

           The names and contents of the kernels referenced
           by this meta-kernel are as follows:

              File name                     Contents
              ---------                     --------
              de421.bsp                     Planetary ephemeris
              pck00010.tpc                  Planet orientation and
                                            radii
              naif0009.tls                  Leapseconds


           \begindata

              KERNELS_TO_LOAD = ( 'de421.bsp',
                                  'pck00010.tpc',
                                  'naif0009.tls'  )

           \begintext

           End of meta-kernel


        Example code begins here.


              PROGRAM DRDGEO_EX1
              IMPLICIT NONE

        C
        C     SPICELIB functions
        C
              DOUBLE PRECISION      <a href="rpd.html">RPD</a>

        C
        C     Local parameters
        C
              CHARACTER*(*)         FMT1
              PARAMETER           ( FMT1 = '(A,E18.8)' )

        C
        C     Local variables
        C
              DOUBLE PRECISION      ALT
              DOUBLE PRECISION      DRECTN ( 3 )
              DOUBLE PRECISION      ET
              DOUBLE PRECISION      F
              DOUBLE PRECISION      JACOBI ( 3, 3 )
              DOUBLE PRECISION      LAT
              DOUBLE PRECISION      LON
              DOUBLE PRECISION      LT
              DOUBLE PRECISION      GEOVEL ( 3 )
              DOUBLE PRECISION      RADII  ( 3 )
              DOUBLE PRECISION      RE
              DOUBLE PRECISION      RECTAN ( 3 )
              DOUBLE PRECISION      RP
              DOUBLE PRECISION      STATE  ( 6 )

              INTEGER               N

        C
        C     Load SPK, PCK, and LSK kernels, use a meta kernel for
        C     convenience.
        C
              CALL <a href="furnsh.html">FURNSH</a> ( 'drdgeo_ex1.tm' )

        C
        C     Look up the radii for Mars.  Although we
        C     omit it here, we could first call <a href="badkpv.html">BADKPV</a>
        C     to make sure the variable BODY499_RADII
        C     has three elements and numeric data type.
        C     If the variable is not present in the kernel
        C     pool, <a href="bodvrd.html">BODVRD</a> will signal an error.
        C
              CALL <a href="bodvrd.html">BODVRD</a> ( 'MARS', 'RADII', 3, N, RADII )

        C
        C     Compute flattening coefficient.
        C
              RE  =  RADII(1)
              RP  =  RADII(3)
              F   =  ( RE - RP ) / RE

        C
        C     Look up the apparent state of earth as seen from Mars
        C     at January 1, 2005 TDB, relative to the IAU_MARS
        C     reference frame.
        C
              CALL <a href="str2et.html">STR2ET</a> ( 'January 1, 2005 TDB', ET )

              CALL <a href="spkezr.html">SPKEZR</a> ( 'Earth', ET,    'IAU_MARS', 'LT+S',
             .              'Mars',  STATE, LT                )

        C
        C     Convert position to geodetic coordinates.
        C
              CALL <a href="recgeo.html">RECGEO</a> ( STATE, RE, F, LON, LAT, ALT )

        C
        C     Convert velocity to geodetic coordinates.
        C

              CALL <a href="dgeodr.html">DGEODR</a> (  STATE(1), STATE(2), STATE(3),
             .               RE,       F,        JACOBI   )

              CALL <a href="mxv.html">MXV</a> ( JACOBI, STATE(4), GEOVEL )

        C
        C     As a check, convert the geodetic state back to
        C     rectangular coordinates.
        C
              CALL <a href="georec.html">GEOREC</a> ( LON, LAT, ALT, RE, F, RECTAN )

              CALL <b>DRDGEO</b> ( LON, LAT, ALT, RE, F, JACOBI )

              CALL <a href="mxv.html">MXV</a> ( JACOBI, GEOVEL, DRECTN )


              WRITE(*,*) ' '
              WRITE(*,*) 'Rectangular coordinates:'
              WRITE(*,*) ' '
              WRITE(*,FMT1) '  X (km)                 = ', STATE(1)
              WRITE(*,FMT1) '  Y (km)                 = ', STATE(2)
              WRITE(*,FMT1) '  Z (km)                 = ', STATE(3)
              WRITE(*,*) ' '
              WRITE(*,*) 'Rectangular velocity:'
              WRITE(*,*) ' '
              WRITE(*,FMT1) '  dX/dt (km/s)           = ', STATE(4)
              WRITE(*,FMT1) '  dY/dt (km/s)           = ', STATE(5)
              WRITE(*,FMT1) '  dZ/dt (km/s)           = ', STATE(6)
              WRITE(*,*) ' '
              WRITE(*,*) 'Ellipsoid shape parameters: '
              WRITE(*,*) ' '
              WRITE(*,FMT1) '  Equatorial radius (km) = ', RE
              WRITE(*,FMT1) '  Polar radius      (km) = ', RP
              WRITE(*,FMT1) '  Flattening coefficient = ', F
              WRITE(*,*) ' '
              WRITE(*,*) 'Geodetic coordinates:'
              WRITE(*,*) ' '
              WRITE(*,FMT1) '  Longitude (deg)        = ', LON / <a href="rpd.html">RPD</a>()
              WRITE(*,FMT1) '  Latitude  (deg)        = ', LAT / <a href="rpd.html">RPD</a>()
              WRITE(*,FMT1) '  Altitude  (km)         = ', ALT
              WRITE(*,*) ' '
              WRITE(*,*) 'Geodetic velocity:'
              WRITE(*,*) ' '
              WRITE(*,FMT1) '  d Longitude/dt (deg/s) = ',
             .                                         GEOVEL(1)/<a href="rpd.html">RPD</a>()
              WRITE(*,FMT1) '  d Latitude/dt  (deg/s) = ',
             .                                         GEOVEL(2)/<a href="rpd.html">RPD</a>()
              WRITE(*,FMT1) '  d Altitude/dt  (km/s)  = ', GEOVEL(3)
              WRITE(*,*) ' '
              WRITE(*,*) 'Rectangular coordinates from inverse ' //
             .           'mapping:'
              WRITE(*,*) ' '
              WRITE(*,FMT1) '  X (km)                 = ', RECTAN(1)
              WRITE(*,FMT1) '  Y (km)                 = ', RECTAN(2)
              WRITE(*,FMT1) '  Z (km)                 = ', RECTAN(3)
              WRITE(*,*) ' '
              WRITE(*,*) 'Rectangular velocity from inverse mapping:'
              WRITE(*,*) ' '
              WRITE(*,FMT1) '  dX/dt (km/s)           = ', DRECTN(1)
              WRITE(*,FMT1) '  dY/dt (km/s)           = ', DRECTN(2)
              WRITE(*,FMT1) '  dZ/dt (km/s)           = ', DRECTN(3)
              WRITE(*,*) ' '
              END


        When this program was executed on a Mac/Intel/gfortran/64-bit
        platform, the output was:


         Rectangular coordinates:

          X (km)                 =    -0.76096183E+08
          Y (km)                 =     0.32436380E+09
          Z (km)                 =     0.47470484E+08

         Rectangular velocity:

          dX/dt (km/s)           =     0.22952075E+05
          dY/dt (km/s)           =     0.53760111E+04
          dZ/dt (km/s)           =    -0.20881149E+02

         Ellipsoid shape parameters:

          Equatorial radius (km) =     0.33961900E+04
          Polar radius      (km) =     0.33762000E+04
          Flattening coefficient =     0.58860076E-02

         Geodetic coordinates:

          Longitude (deg)        =     0.10320290E+03
          Latitude  (deg)        =     0.81089876E+01
          Altitude  (km)         =     0.33653182E+09

         Geodetic velocity:

          d Longitude/dt (deg/s) =    -0.40539288E-02
          d Latitude/dt  (deg/s) =    -0.33189934E-05
          d Altitude/dt  (km/s)  =    -0.11211601E+02

         Rectangular coordinates from inverse mapping:

          X (km)                 =    -0.76096183E+08
          Y (km)                 =     0.32436380E+09
          Z (km)                 =     0.47470484E+08

         Rectangular velocity from inverse mapping:

          dX/dt (km/s)           =     0.22952075E+05
          dY/dt (km/s)           =     0.53760111E+04
          dZ/dt (km/s)           =    -0.20881149E+02
</PRE>
<h4><a name="Restrictions">Restrictions</a></h4>
<PRE>
     None.
</PRE>
<h4><a name="Literature_References">Literature_References</a></h4>
<PRE>
     None.
</PRE>
<h4><a name="Author_and_Institution">Author_and_Institution</a></h4>
<PRE>
     J. Diaz del Rio    (ODC Space)
     W.L. Taber         (JPL)
</PRE>
<h4><a name="Version">Version</a></h4>
<PRE>
    SPICELIB Version 1.1.0, 26-OCT-2021 (JDR)

        Changed the input argument name LONG to LON for consistency
        with other routines.

        Edited the header to comply with NAIF standard.
        Added complete code example.

    SPICELIB Version 1.0.0, 20-JUL-2001 (WLT)</PRE>
<h4>Link to routine DRDGEO source file <a href='../../../src/spicelib/drdgeo.f'>drdgeo.f</a> </h4>

      </td>
    </tr>
  </tbody>
</table>

   <pre>Fri Dec 31 18:36:14 2021</pre>

</body>
</html>

