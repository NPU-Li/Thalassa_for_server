
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<HTML>

<HEAD>
   <TITLE>daswbr</TITLE>
</HEAD>

<BODY style="color: rgb(0, 0, 0); background-color: rgb(255, 255, 255);">
<A name="TOP"></A>

<table style="text-align: left; margin-left: auto; margin-right: auto; width: 800px;"
 border="0" cellpadding="5" cellspacing="2">
  <tbody>
    <tr><td>
<div align="center">
Index of Functions: 
<A HREF="index.html#A">A</A>&nbsp;
<A HREF="index.html#B">B</A>&nbsp;
<A HREF="index.html#C">C</A>&nbsp;
<A HREF="index.html#D">D</A>&nbsp;
<A HREF="index.html#E">E</A>&nbsp;
<A HREF="index.html#F">F</A>&nbsp;
<A HREF="index.html#G">G</A>&nbsp;
<A HREF="index.html#H">H</A>&nbsp;
<A HREF="index.html#I">I</A>&nbsp;
<A HREF="index.html#J">J</A>&nbsp;
<A HREF="index.html#K">K</A>&nbsp;
<A HREF="index.html#L">L</A>&nbsp;
<A HREF="index.html#M">M</A>&nbsp;
<A HREF="index.html#N">N</A>&nbsp;
<A HREF="index.html#O">O</A>&nbsp;
<A HREF="index.html#P">P</A>&nbsp;
<A HREF="index.html#Q">Q</A>&nbsp;
<A HREF="index.html#R">R</A>&nbsp;
<A HREF="index.html#S">S</A>&nbsp;
<A HREF="index.html#T">T</A>&nbsp;
<A HREF="index.html#U">U</A>&nbsp;
<A HREF="index.html#V">V</A>&nbsp;
<A HREF="index.html#W">W</A>&nbsp;
<A HREF="index.html#X">X</A>&nbsp;
</div>
</td></tr>

    <tr>
      <td style="background-color: rgb(153, 153, 153); vertical-align: middle; text-align: center;">
      <div align="right"> 
      <small><small><a href="index.html">Index Page</a></small></small>
      </div>
      <b>daswbr</b></td>
    </tr>
    

    <tr>
      <td style="vertical-align: top;">

       <br>
       <div align="left"><b>Table of contents</b></div>
       <table style="text-align: left; width: 60%; margin-left: auto; margin-right: auto;"
       border="0" cellspacing="2" cellpadding="2">
        <tbody>
          <tr>
            <td style="width: 33%; text-align: center;">
              <a href="#Procedure">Procedure<br></a>
              <a href="#Abstract">Abstract<br></a>
              <a href="#Required_Reading">Required_Reading<br></a>
              <a href="#Keywords">Keywords<br></a>
              <a href="#Declarations">Declarations<br></a>
              <a href="#Brief_I/O">Brief_I/O<br></a>

              </td>
              <td style="vertical-align: top; width: 33%; text-align: center;">              <a href="#Detailed_Input">Detailed_Input<br></a>
              <a href="#Detailed_Output">Detailed_Output<br></a>
              <a href="#Parameters">Parameters<br></a>
              <a href="#Exceptions">Exceptions<br></a>
              <a href="#Files">Files<br></a>
              <a href="#Particulars">Particulars<br></a>

              </td>
              <td style="vertical-align: top; width: 33%; text-align: center;">              <big><b><a href="#Examples">Examples<br></a></b></big>
              <a href="#Restrictions">Restrictions<br></a>
              <a href="#Literature_References">Literature_References<br></a>
              <a href="#Author_and_Institution">Author_and_Institution<br></a>
              <a href="#Version">Version<br></a>
            </td>
          </tr>
        </tbody>
</table>
<hr>

<h4><a name="Procedure">Procedure</a></h4>
<PRE>
     DASWBR ( DAS, write buffered records )

     ENTRY DASWBR ( HANDLE )
</PRE>
<h4><a name="Abstract">Abstract</a></h4>
<PRE>
     Write out all buffered records of a specified DAS file.
</PRE>
<h4><a name="Required_Reading">Required_Reading</a></h4>
<PRE>
     <a href="../req/das.html">DAS</a>
</PRE>
<h4><a name="Keywords">Keywords</a></h4>
<PRE>
     ASSIGNMENT
     DAS
     FILES
</PRE>
<h4><a name="Declarations">Declarations</a></h4>
<PRE>
    INTEGER               HANDLE
</PRE>
<h4><a name="Brief_I/O">Brief_I/O</a></h4>
<PRE>
     VARIABLE  I/O  DESCRIPTION
     --------  ---  --------------------------------------------------
     HANDLE     I   Handle of DAS file.
</PRE>
<h4><a name="Detailed_Input">Detailed_Input</a></h4>
<PRE>
     HANDLE   is the handle of a DAS file opened for writing.
</PRE>
<h4><a name="Detailed_Output">Detailed_Output</a></h4>
<PRE>
     None.

     See $Particulars for a description of the action of this routine.
</PRE>
<h4><a name="Parameters">Parameters</a></h4>
<PRE>
     None.
</PRE>
<h4><a name="Exceptions">Exceptions</a></h4>
<PRE>
     1)  If the input file handle is invalid, an error is signaled
         by a routine in the call tree of this routine. The indicated
         file will not be modified.

     2)  If a write operation attempted by this routine fails, an
         error is signaled by a routine in the call tree of this
         routine. The status of the DAS file written to is uncertain
         in this case.
</PRE>
<h4><a name="Files">Files</a></h4>
<PRE>
     See the description of the argument HANDLE in $Detailed_Input.
</PRE>
<h4><a name="Particulars">Particulars</a></h4>
<PRE>
     This routine writes buffered records out to the DAS file to which
     they correspond.

     Because the DAS system buffers records that are written as well as
     those that are read, data supplied to the DAS add data (<a href="dasadc.html">DASADC</a>,
     <a href="dasadd.html">DASADD</a>, <a href="dasadi.html">DASADI</a>) and DAS update data (<a href="dasudc.html">DASUDC</a>, <a href="dasudd.html">DASUDD</a>, <a href="dasudi.html">DASUDI</a>)
     routines on input has not necessarily been physically written to
     the DAS file specified by the caller of those routines, at the
     time those routines return. Before closing a DAS file that has
     been opened for writing, the DAS system must write out to the file
     any updated records present in the DAS buffers. The SPICELIB
     routine <a href="dascls.html">DASCLS</a> uses this routine to perform this function. The
     routines <a href="dasac.html">DASAC</a> and <a href="dasdc.html">DASDC</a>, through the use of the SPICELIB routines
     <a href="dasacr.html">DASACR</a> and <a href="dasrcr.html">DASRCR</a>, which respectively add comment records to or
     delete comment records from a DAS file, use this routine to ensure
     that the SPICELIB routine <a href="dasrwr.html">DASRWR</a> record buffers don't become out
     of sync with the file they operate upon.

     In addition, this routine can be used by application programs
     that create or update DAS files. The reason for calling this
     routine directly would be to provide a measure of safety when
     writing a very large file: if the file creation or update were
     interrupted, the amount of work lost due to the loss of buffered,
     unwritten records could be reduced.

     However, routines outside of SPICELIB will generally not need to
     call this routine directly.
</PRE>
<h4><a name="Examples">Examples</a></h4>
<PRE>
     The numerical results shown for this example may differ across
     platforms. The results depend on the SPICE kernels used as
     input, the compiler and supporting libraries, and the machine
     specific arithmetic implementation.

     1) Write a DAS file by adding data to it over multiple passes.
        Avoid spending time on file segregation between writes.

        Each pass opens the file, adds character, double precision,
        and integer data to the file, writes out buffered data by
        calling <b>DASWBR</b>, and closes the file without segregating the
        data by calling DASLLC.

        The program also checks the file: after the final write,
        the program reads the data and compares it to expected values.

        Note that most user-oriented applications should segregate a
        DAS file after writing it, since this greatly enhances file
        reading efficiency. The technique demonstrated here may be
        useful for cases in which a file will be written via many
        small data additions, and in which the file is read between
        write operations.


        Example code begins here.


              PROGRAM DASWBR_EX1
              IMPLICIT NONE

        C
        C     Local parameters
        C
              INTEGER               FILSIZ
              PARAMETER           ( FILSIZ = 255 )

              INTEGER               FTYPLN
              PARAMETER           ( FTYPLN = 3 )

              INTEGER               CHRLEN
              PARAMETER           ( CHRLEN = 50 )

              INTEGER               IBUFSZ
              PARAMETER           ( IBUFSZ = 20 )

              INTEGER               DBUFSZ
              PARAMETER           ( DBUFSZ = 30 )

        C
        C     Local variables
        C
              CHARACTER*(CHRLEN)    CHRBUF
              CHARACTER*(FILSIZ)    FNAME
              CHARACTER*(FTYPLN)    FTYPE
              CHARACTER*(CHRLEN)    XCHRBF

              DOUBLE PRECISION      DPBUF  ( DBUFSZ )
              DOUBLE PRECISION      XDPBUF ( DBUFSZ )

              INTEGER               FIRSTC
              INTEGER               FIRSTD
              INTEGER               FIRSTI
              INTEGER               HANDLE
              INTEGER               I
              INTEGER               INTBUF ( IBUFSZ )
              INTEGER               J
              INTEGER               LASTC
              INTEGER               LASTD
              INTEGER               LASTI
              INTEGER               NCALL
              INTEGER               NCOMR
              INTEGER               NPASS
              INTEGER               PASSNO
              INTEGER               XINTBF ( IBUFSZ )


        C
        C     Initial values
        C
              DATA                  FNAME  / 'daswbr_ex1.das' /
              DATA                  FTYPE  / 'ANG' /
              DATA                  NCALL  / 1000  /
              DATA                  NCOMR  / 10    /
              DATA                  NPASS  / 3     /

        C
        C     Open a new DAS file. We'll allocate NCOMR records
        C     for comments. The file type is not one of the standard
        C     types recognized by SPICE; however it can be used to
        C     ensure the database file is of the correct type.
        C
        C     We'll use the file name as the internal file name.
        C
              CALL DASONW ( FNAME, FTYPE, FNAME, NCOMR, HANDLE )

        C
        C     Add data of character, integer, and double precision
        C     types to the file in interleaved fashion. We'll add to
        C     the file over NPASS &quot;passes,&quot; in each of which we close
        C     the file after writing.
        C
              DO PASSNO = 1, NPASS

                 IF ( PASSNO .GT. 1 ) THEN

                    WRITE (*,*) 'Opening file for write access...'

                    CALL DASOPW( FNAME, HANDLE )

                 END IF

                 DO I = 1, NCALL
        C
        C           Add string data to the file.
        C
                    CHRBUF = 'Character value #'
                    CALL <a href="repmi.html">REPMI</a>( CHRBUF, '#', I, CHRBUF )

                    CALL <a href="dasadc.html">DASADC</a> ( HANDLE, CHRLEN, 1, CHRLEN, CHRBUF )

        C
        C           Add double precision data to the file.
        C
                    DO J = 1, DBUFSZ
                       DPBUF(J) = DBLE( 100000000*PASSNO + 100*I + J )
                    END DO

                    CALL <a href="dasadd.html">DASADD</a> ( HANDLE, DBUFSZ, DPBUF )

        C
        C           Add integer data to the file.
        C
                    DO J = 1, IBUFSZ
                       INTBUF(J) = 100000000*PASSNO  +  100 * I  +  J
                    END DO

                    CALL <a href="dasadi.html">DASADI</a> ( HANDLE, IBUFSZ, INTBUF )

                 END DO

        C
        C        Write buffered data to the file.
        C
                 WRITE (*,*) 'Writing buffered data...'
                 CALL <b>DASWBR</b> ( HANDLE )

        C
        C        Close the file without segregating it.
        C
                 WRITE (*,*) 'Closing DAS file...'
                 CALL DASLLC ( HANDLE )

              END DO

              WRITE (*,*) 'File write is done.'

        C
        C     Check file contents.
        C
              CALL DASOPR( FNAME, HANDLE )

        C
        C     Read data from the file; compare to expected values.
        C
        C     Initialize end addresses.
        C
              LASTC = 0
              LASTD = 0
              LASTI = 0

              DO PASSNO = 1, NPASS

                 DO I = 1, NCALL

        C
        C           Check string data.
        C
                    XCHRBF = 'Character value #'
                    CALL <a href="repmi.html">REPMI</a>( XCHRBF, '#', I, XCHRBF )

                    FIRSTC = LASTC + 1
                    LASTC  = LASTC + CHRLEN

                    CALL <a href="dasrdc.html">DASRDC</a> ( HANDLE, FIRSTC, LASTC,
             .                    1,      CHRLEN, CHRBUF )

                    IF ( CHRBUF .NE. XCHRBF ) THEN
                       WRITE (*,*) 'Character data mismatch: '
                       WRITE (*,*) 'PASS     = ', PASSNO
                       WRITE (*,*) 'I        = ', I
                       WRITE (*,*) 'Expected = ', XCHRBF
                       WRITE (*,*) 'Actual   = ', CHRBUF
                       STOP
                    END IF

        C
        C           Check double precision data.
        C
                    DO J = 1, DBUFSZ
                       XDPBUF(J) = DBLE(   100000000*PASSNO
             .                           + 100*I + J        )
                    END DO

                    FIRSTD = LASTD + 1
                    LASTD  = LASTD + DBUFSZ

                    CALL <a href="dasrdd.html">DASRDD</a> ( HANDLE, FIRSTD, LASTD, DPBUF )

                    DO J = 1, DBUFSZ

                       IF ( DPBUF(J) .NE. XDPBUF(J) ) THEN

                          WRITE (*,*)
             .                   'Double precision data mismatch: '
                          WRITE (*,*) 'PASS     = ', PASSNO
                          WRITE (*,*) 'I        = ', I
                          WRITE (*,*) 'J        = ', J
                          WRITE (*,*) 'Expected = ', XDPBUF(J)
                          WRITE (*,*) 'Actual   = ', DPBUF(J)
                          STOP

                       END IF

                    END DO

        C
        C           Check integer data.
        C
                    DO J = 1, IBUFSZ
                       XINTBF(J) = 100000000*PASSNO  +  100 * I  +  J
                    END DO

                    FIRSTI = LASTI + 1
                    LASTI  = LASTI + IBUFSZ

                    CALL <a href="dasrdi.html">DASRDI</a> ( HANDLE, FIRSTI, LASTI, INTBUF )

                    DO J = 1, IBUFSZ

                       IF ( INTBUF(J) .NE. XINTBF(J) ) THEN

                          WRITE (*,*) 'Integer data mismatch: '
                          WRITE (*,*) 'PASS     = ', PASSNO
                          WRITE (*,*) 'I        = ', I
                          WRITE (*,*) 'J        = ', J
                          WRITE (*,*) 'Expected = ', XINTBF(J)
                          WRITE (*,*) 'Actual   = ', INTBUF(J)
                          STOP

                       END IF

                    END DO

                 END DO

              END DO

              WRITE (*,*) 'File check is done.'

        C
        C     Close the file.
        C
              CALL <a href="dascls.html">DASCLS</a> ( HANDLE )

              END


        When this program was executed on a Mac/Intel/gfortran/64-bit
        platform, the output was:


         Writing buffered data...
         Closing DAS file...
         Opening file for write access...
         Writing buffered data...
         Closing DAS file...
         Opening file for write access...
         Writing buffered data...
         Closing DAS file...
         File write is done.
         File check is done.


        Note that after run completion, a new DAS file exists in the
        output directory.
</PRE>
<h4><a name="Restrictions">Restrictions</a></h4>
<PRE>
     None.
</PRE>
<h4><a name="Literature_References">Literature_References</a></h4>
<PRE>
     None.
</PRE>
<h4><a name="Author_and_Institution">Author_and_Institution</a></h4>
<PRE>
     N.J. Bachman       (JPL)
     J. Diaz del Rio    (ODC Space)
     K.R. Gehringer     (JPL)
     W.L. Taber         (JPL)
</PRE>
<h4><a name="Version">Version</a></h4>
<PRE>
    SPICELIB Version 2.0.1, 19-MAY-2021 (NJB) (JDR)

        Edited the header to comply with NAIF standard. Added complete
        code example.

        Updated $Particulars in order to provide information about the
        high level APIs that actually use this routine.

    SPICELIB Version 2.0.0, 30-JUL-2014 (NJB)

        Upgraded to support handle manager integration.

    SPICELIB Version 1.0.2, 03-NOV-1995 (NJB)

        Removed weird spaces from ENTRY statement.

    SPICELIB Version 1.0.1, 28-OCT-1993 (KRG)

        Removed references to specific DAS file open routines in the
        $Detailed_Input section of the header. This was done in order
        to minimize documentation changes if the DAS open routines ever
        change.

    SPICELIB Version 1.0.0, 30-JUN-1992 (NJB) (WLT)</PRE>
<h4>Link to routine DASWBR source file <a href='../../../src/spicelib/dasrwr.f'>dasrwr.f</a> </h4>

      </td>
    </tr>
  </tbody>
</table>

   <pre>Fri Dec 31 18:36:12 2021</pre>

</body>
</html>

