
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<HTML>

<HEAD>
   <TITLE>ekpsel</TITLE>
</HEAD>

<BODY style="color: rgb(0, 0, 0); background-color: rgb(255, 255, 255);">
<A name="TOP"></A>

<table style="text-align: left; margin-left: auto; margin-right: auto; width: 800px;"
 border="0" cellpadding="5" cellspacing="2">
  <tbody>
    <tr><td>
<div align="center">
Index of Functions: 
<A HREF="index.html#A">A</A>&nbsp;
<A HREF="index.html#B">B</A>&nbsp;
<A HREF="index.html#C">C</A>&nbsp;
<A HREF="index.html#D">D</A>&nbsp;
<A HREF="index.html#E">E</A>&nbsp;
<A HREF="index.html#F">F</A>&nbsp;
<A HREF="index.html#G">G</A>&nbsp;
<A HREF="index.html#H">H</A>&nbsp;
<A HREF="index.html#I">I</A>&nbsp;
<A HREF="index.html#J">J</A>&nbsp;
<A HREF="index.html#K">K</A>&nbsp;
<A HREF="index.html#L">L</A>&nbsp;
<A HREF="index.html#M">M</A>&nbsp;
<A HREF="index.html#N">N</A>&nbsp;
<A HREF="index.html#O">O</A>&nbsp;
<A HREF="index.html#P">P</A>&nbsp;
<A HREF="index.html#Q">Q</A>&nbsp;
<A HREF="index.html#R">R</A>&nbsp;
<A HREF="index.html#S">S</A>&nbsp;
<A HREF="index.html#T">T</A>&nbsp;
<A HREF="index.html#U">U</A>&nbsp;
<A HREF="index.html#V">V</A>&nbsp;
<A HREF="index.html#W">W</A>&nbsp;
<A HREF="index.html#X">X</A>&nbsp;
</div>
</td></tr>

    <tr>
      <td style="background-color: rgb(153, 153, 153); vertical-align: middle; text-align: center;">
      <div align="right"> 
      <small><small><a href="index.html">Index Page</a></small></small>
      </div>
      <b>ekpsel</b></td>
    </tr>
    

    <tr>
      <td style="vertical-align: top;">

       <br>
       <div align="left"><b>Table of contents</b></div>
       <table style="text-align: left; width: 60%; margin-left: auto; margin-right: auto;"
       border="0" cellspacing="2" cellpadding="2">
        <tbody>
          <tr>
            <td style="width: 33%; text-align: center;">
              <a href="#Procedure">Procedure<br></a>
              <a href="#Abstract">Abstract<br></a>
              <a href="#Required_Reading">Required_Reading<br></a>
              <a href="#Keywords">Keywords<br></a>
              <a href="#Declarations">Declarations<br></a>
              <a href="#Brief_I/O">Brief_I/O<br></a>

              </td>
              <td style="vertical-align: top; width: 33%; text-align: center;">              <a href="#Detailed_Input">Detailed_Input<br></a>
              <a href="#Detailed_Output">Detailed_Output<br></a>
              <a href="#Parameters">Parameters<br></a>
              <a href="#Exceptions">Exceptions<br></a>
              <a href="#Files">Files<br></a>
              <a href="#Particulars">Particulars<br></a>

              </td>
              <td style="vertical-align: top; width: 33%; text-align: center;">              <big><b><a href="#Examples">Examples<br></a></b></big>
              <a href="#Restrictions">Restrictions<br></a>
              <a href="#Literature_References">Literature_References<br></a>
              <a href="#Author_and_Institution">Author_and_Institution<br></a>
              <a href="#Version">Version<br></a>
            </td>
          </tr>
        </tbody>
</table>
<hr>

<h4><a name="Procedure">Procedure</a></h4>
<PRE>
     EKPSEL ( EK, parse SELECT clause )

     SUBROUTINE EKPSEL (  QUERY,   N,     XBEGS,  XENDS,  XTYPES,
    .                     XCLASS,  TABS,  COLS,   ERROR,  ERRMSG  )
</PRE>
<h4><a name="Abstract">Abstract</a></h4>
<PRE>
     Parse the SELECT clause of an EK query, returning full particulars
     concerning each selected item.
</PRE>
<h4><a name="Required_Reading">Required_Reading</a></h4>
<PRE>
     None.
</PRE>
<h4><a name="Keywords">Keywords</a></h4>
<PRE>
     PRIVATE
</PRE>
<h4><a name="Declarations">Declarations</a></h4>
<PRE>
     IMPLICIT NONE

     INCLUDE 'ekattdsc.inc'
     INCLUDE 'ekcnamsz.inc'
     INCLUDE 'ekqlimit.inc'
     INCLUDE 'ekquery.inc'
     INCLUDE 'ektnamsz.inc'
     INCLUDE 'ektype.inc'

     CHARACTER*(*)         QUERY
     INTEGER               N
     INTEGER               XBEGS  ( * )
     INTEGER               XENDS  ( * )
     CHARACTER*(*)         XTYPES ( * )
     CHARACTER*(*)         XCLASS ( * )
     CHARACTER*(*)         TABS   ( * )
     CHARACTER*(*)         COLS   ( * )
     LOGICAL               ERROR
     CHARACTER*(*)         ERRMSG
</PRE>
<h4><a name="Brief_I/O">Brief_I/O</a></h4>
<PRE>
     VARIABLE  I/O  DESCRIPTION
     --------  ---  --------------------------------------------------
     QUERY      I   EK query.
     N          O   Number of items in SELECT clause of QUERY.
     XBEGS      O   Begin positions of expressions in SELECT clause.
     XENDS      O   End positions of expressions in SELECT clause.
     XTYPES     O   Data types of expressions.
     XCLASS     O   Classes of expressions.
     TABS       O   Names of tables qualifying SELECT columns.
     COLS       O   Names of columns in SELECT clause of QUERY.
     ERROR      O   Error flag.
     ERRMSG     O   Parse error message.
</PRE>
<h4><a name="Detailed_Input">Detailed_Input</a></h4>
<PRE>
     QUERY    is a character string containing an EK query.
              EK queries have the general form

                 SELECT &lt;select expr&gt;, &lt;select expr&gt;, ...
                 FROM &lt;table spec&gt;, &lt;table spec&gt;, ...
                 [WHERE &lt;constraint list&gt;]
                 [ORDER BY &lt;order-by column list&gt;]

              Here the symbol &lt;select expr&gt; indicates any
              expression representing an entity that can be
              selected. Commonly, the selected items are
              columns, with or without qualifying table names,
              having the form

                 &lt;column name&gt;
                 &lt;table name&gt;.&lt;column name&gt;
                 &lt;table alias&gt;.&lt;column name&gt;

              but more general expressions may also be selected.
              Examples are functions, such as

                 COUNT(*)
                 COUNT( &lt;table name&gt;.&lt;column name&gt; )
                 MAX  ( &lt;table name&gt;.&lt;column name&gt; )

              or expressions involving constants, such as

                 2 * &lt;column name&gt;
</PRE>
<h4><a name="Detailed_Output">Detailed_Output</a></h4>
<PRE>
     N        is the number of items specified in the
              SELECT clause of the input query.

     XBEGS,
     XENDS    are, respectively, arrays of begin and end
              positions of expressions designating items in the
              SELECT clause of the input query. The Ith
              expression is located in the substring

                 QUERY ( XBEGS(I) : XENDS(I) )

     XTYPES   is an array of short strings indicating the data
              types of the expressions in the SELECT clause.
              Values and meanings of XTYPES are:

                 'CHR'        Character type
                 'DP'         Double precision type
                 'INT'        Integer type
                 'TIME'       Time type

              The Ith element of XTYPES refers to the Ith
              selected item.

              The data type of an expression indicates which
              fetch routine to use to obtain values of the
              selected expression. The mapping of data types
              to fetch routines is shown below:

                 'CHR'        <a href="ekgc.html">EKGC</a>
                 'DP'         <a href="ekgd.html">EKGD</a>
                 'INT'        <a href="ekgi.html">EKGI</a>
                 'TIME'       <a href="ekgd.html">EKGD</a>

              Note that time values are stored as d.p. numbers.

     XCLASS   is an array of short strings giving the classes
              of the expressions occurring in the SELECT clause
              of the input query. Values and meanings of
              XCLASS are:

                 'COL'        Selected item was a column. The
                              column may qualified.

                 'FUNC'       Selected item was a simple
                              function invocation of the form

                                 F ( &lt;column&gt; )

                              or else was

                                 COUNT(*)

                 'EXPR'       Selected item was a more general
                              expression than those shown above.

              The Ith element of XCLASS refers to the Ith
              selected item.

              When a selected item is a column, the values of
              the arguments TABS and COLS (discussed below) are
              defined.

     TABS     is an array of names of tables corresponding to
              the columns in the SELECT clause. The Ith element
              of TABS corresponds to the table containing the
              Ith SELECT column. Table names returned in TABS
              are the actual names of tables in loaded EK, not
              aliases supplied in the input query. Table names
              are supplied even if the corresponding column was
              unqualified in the input query, as long as the
              column name was unambiguous.

              The contents of TABS(I) are defined if and only if
              the returned value of XCLASS(I) is 'COL'.

     COLS     is an array containing the columns of the SELECT
              clause. The contents of COLS(I) are defined if and
              only if the returned value of XCLASS(I) is 'COL'.

     ERROR    is a logical flag indicating whether the input
              QUERY parsed correctly. The other outputs of this
              routine, except for ERRMSG, are undefined if a
              parse error occurred. ERROR is returned .TRUE. if
              a parse error occurred, .FALSE. otherwise.

     ERRMSG   is a character string describing the cause of a
              parse error, if such an error occurred. Otherwise,
              ERRMSG is returned blank.
</PRE>
<h4><a name="Parameters">Parameters</a></h4>
<PRE>
     None.
</PRE>
<h4><a name="Exceptions">Exceptions</a></h4>
<PRE>
     1)  Parse failures do not cause this routine to signal errors;
         instead, the ERROR and ERRMSG outputs indicate invalid
         QUERY.

     2)  Queries cannot be parsed correctly unless at least one EK
         is loaded.
</PRE>
<h4><a name="Files">Files</a></h4>
<PRE>
     None.
</PRE>
<h4><a name="Particulars">Particulars</a></h4>
<PRE>
     This routine allows callers of the EK fetch routines to determine
     at run time the attributes of the columns from which data is to be
     fetched.
</PRE>
<h4><a name="Examples">Examples</a></h4>
<PRE>
     The numerical results shown for this example may differ across
     platforms. The results depend on the SPICE kernels used as
     input, the compiler and supporting libraries, and the machine
     specific arithmetic implementation.

     1) Query the EK system and fetch data matching that query.

        The program shown here does not rely on advance
        knowledge of the input query or the contents of any loaded EK
        files.

        To simplify the example, we assume that all data are scalar.
        This assumption relieves us of the need to test the size of
        column entries before fetching them. In the event that a
        column contains variable-size array entries, the entry point
        <a href="eknelt.html">EKNELT</a> may be called to obtain the size of column entries to
        be fetched. See <a href="eknelt.html">EKNELT</a> for an example.


        Use the EK kernel below to load the information from the
        original Supplementary Engineering Data Record (SEDR) data
        set generated by the Viking Project.

           vo_sedr.bdb

        Use the LSK kernel below to load the leap seconds and time
        constants required for the conversions.

           naif0012.tls


        Example code begins here.


              PROGRAM EKPSEL_EX1
              IMPLICIT NONE

        C
        C     Include EK Query Limit Parameters
        C
              INCLUDE 'ekqlimit.inc'

        C
        C     SPICELIB functions
        C
              INTEGER               <a href="rtrim.html">RTRIM</a>

        C
        C     Local parameters
        C
              CHARACTER*(*)         EKNAME
              PARAMETER           ( EKNAME = 'vo_sedr.bdb' )

              CHARACTER*(*)         LSKNAM
              PARAMETER           ( LSKNAM = 'naif0012.tls' )

              INTEGER               DESCSZ
              PARAMETER           ( DESCSZ = 31   )

              INTEGER               ERRLEN
              PARAMETER           ( ERRLEN = 1840 )

              INTEGER               ITEMSZ
              PARAMETER           ( ITEMSZ = DESCSZ + 4 )

              INTEGER               TIMLEN
              PARAMETER           ( TIMLEN = 27   )

              INTEGER               TYPLEN
              PARAMETER           ( TYPLEN = 4    )

              INTEGER               XCLSLN
              PARAMETER           ( XCLSLN = 4    )

        C
        C     Local variables
        C
              CHARACTER*(MAXSTR)    CDATA
              CHARACTER*(MAXCLN)    COLS   ( MAXSEL )
              CHARACTER*(ERRLEN)    ERRMSG
              CHARACTER*(ITEMSZ)    ITEM
              CHARACTER*(DESCSZ)    OUTSTR
              CHARACTER*(MAXQRY)    QUERY
              CHARACTER*(TIMLEN)    UTCSTR
              CHARACTER*(MAXCLN)    TABS   ( MAXTAB )
              CHARACTER*(XCLSLN)    XCLASS ( MAXSEL )
              CHARACTER*(TYPLEN)    XTYPES ( MAXSEL )

              DOUBLE PRECISION      DDATA
              DOUBLE PRECISION      TDATA

              INTEGER               B
              INTEGER               COLNO
              INTEGER               E
              INTEGER               HANDLE
              INTEGER               IDATA
              INTEGER               N
              INTEGER               NMROWS
              INTEGER               ROW
              INTEGER               XBEGS  ( MAXSEL )
              INTEGER               XENDS  ( MAXSEL )

              LOGICAL               ERROR
              LOGICAL               FOUND
              LOGICAL               NULL

        C
        C     Load leapseconds file for time conversion.
        C
              CALL <a href="furnsh.html">FURNSH</a> ( LSKNAM )

        C
        C     Load EK.
        C
              CALL <a href="eklef.html">EKLEF</a>  ( EKNAME, HANDLE )

        C
        C     Setup the query.  Parse the SELECT clause using
        C     <b>EKPSEL</b>.
        C
              QUERY = 'Select IMAGE_NUMBER, IMAGE_ID, '
             .   //          'PLATFORM_CLOCK, IMAGE_TIME '
             .   //   'from VIKING_SEDR_DATA '
             .   //   'where IMAGE_NUMBER &lt; 25850000 '
             .   //   'order by IMAGE_NUMBER'

              CALL <b>EKPSEL</b> ( QUERY,  N,    XBEGS, XENDS, XTYPES,
             .              XCLASS, TABS, COLS,  ERROR, ERRMSG )

              IF ( ERROR ) THEN

                 WRITE(*,*) ERRMSG

              ELSE

        C
        C        Submit query to the EK query system.
        C
                 CALL <a href="ekfind.html">EKFIND</a> ( QUERY, NMROWS, ERROR, ERRMSG )

                 IF ( ERROR ) THEN

                    WRITE(*,*) ERRMSG

                 ELSE

        C
        C           Fetch the rows that matched the query.
        C
                    DO ROW = 1, NMROWS

        C
        C              Fetch data from the Ith row.
        C
                       WRITE (*,*) ' '
                       WRITE (*,*) 'ROW = ', ROW

                       DO COLNO = 1, N

        C
        C                 Fetch the data from the Jth selected
        C                 column.
        C
                          IF ( XCLASS(COLNO) .EQ. 'COL' ) THEN

                             OUTSTR  =  COLS(COLNO)
                             CALL <a href="prefix.html">PREFIX</a> ( '.',         0, OUTSTR )
                             CALL <a href="prefix.html">PREFIX</a> ( TABS(COLNO), 0, OUTSTR )
                             ITEM = '  ' // OUTSTR // ':'

                          ELSE

                             B  =  XBEGS(COLNO)
                             E  =  XENDS(COLNO)
                             ITEM = '  ITEM = ' // QUERY(B:E)

                          END IF

                          IF ( XTYPES(COLNO) .EQ. 'CHR' ) THEN

                             CALL <a href="ekgc.html">EKGC</a> ( COLNO,  ROW,  1,
             .                           CDATA, NULL, FOUND )

                             IF ( NULL ) THEN
                                WRITE(*,*) ITEM, '&lt;Null&gt;'
                             ELSE
                                WRITE(*,*) ITEM, CDATA(:<a href="rtrim.html">RTRIM</a>(CDATA))
                             END IF


                          ELSE IF ( XTYPES(COLNO) .EQ. 'DP' ) THEN

                             CALL <a href="ekgd.html">EKGD</a> ( COLNO,  ROW,  1,
             .                           DDATA, NULL, FOUND )

                             IF ( NULL ) THEN
                                WRITE(*,*) ITEM, '&lt;Null&gt;'
                             ELSE
                                WRITE(*,*) ITEM, DDATA
                             END IF


                          ELSE IF ( XTYPES(COLNO) .EQ. 'INT' ) THEN

                             CALL <a href="ekgi.html">EKGI</a> ( COLNO,  ROW,  1,
             .                           IDATA, NULL, FOUND )

                             IF ( NULL ) THEN
                                WRITE(*,*) ITEM, '&lt;Null&gt;'
                             ELSE
                                WRITE(*,*) ITEM, IDATA
                             END IF


                          ELSE
        C
        C                    The item is a time value.  Convert it
        C                    to UTC for output.
        C
                             CALL <a href="ekgd.html">EKGD</a> ( COLNO,  ROW,  1,
             .                           TDATA, NULL, FOUND )

                             IF ( NULL ) THEN
                                WRITE(*,*) ITEM, '&lt;Null&gt;'
                             ELSE
                                CALL <a href="et2utc.html">ET2UTC</a> ( TDATA, 'C', 3, UTCSTR )
                                WRITE(*,*) ITEM, UTCSTR
                             END IF

                          END IF

        C
        C              We're done with the column having index COLNO.
        C
                       END DO

        C
        C           We're done with the row having index ROW.
        C
                    END DO

        C
        C        We either processed the query or had an error.
        C
                 END IF

        C
        C     We either parsed the SELECT clause or had an error.
        C
              END IF

              END


        When this program was executed on a Mac/Intel/gfortran/64-bit
        platform, the output was:


         ROW =            1
           VIKING_SEDR_DATA.IMAGE_NUMBER  :     25837050
           VIKING_SEDR_DATA.IMAGE_ID      : 168C09
           VIKING_SEDR_DATA.PLATFORM_CLOCK:    119.88000000000000
           VIKING_SEDR_DATA.IMAGE_TIME    : 1976 JUN 16 16:50:55.925

         ROW =            2
           VIKING_SEDR_DATA.IMAGE_NUMBER  :     25837051
           VIKING_SEDR_DATA.IMAGE_ID      : 168C10
           VIKING_SEDR_DATA.PLATFORM_CLOCK:    119.27000000000000
           VIKING_SEDR_DATA.IMAGE_TIME    : 1976 JUN 16 16:51:00.269

         ROW =            3
           VIKING_SEDR_DATA.IMAGE_NUMBER  :     25840344
           VIKING_SEDR_DATA.IMAGE_ID      : 168C11
           VIKING_SEDR_DATA.PLATFORM_CLOCK:    119.88000000000000
           VIKING_SEDR_DATA.IMAGE_TIME    : 1976 JUN 16 20:56:53.051

         ROW =            4
           VIKING_SEDR_DATA.IMAGE_NUMBER  :     25840345
           VIKING_SEDR_DATA.IMAGE_ID      : 168C12
           VIKING_SEDR_DATA.PLATFORM_CLOCK:    119.27000000000000
           VIKING_SEDR_DATA.IMAGE_TIME    : 1976 JUN 16 20:56:57.395

         ROW =            5
           VIKING_SEDR_DATA.IMAGE_NUMBER  :     25843638
           VIKING_SEDR_DATA.IMAGE_ID      : 169C01
           VIKING_SEDR_DATA.PLATFORM_CLOCK:    119.88000000000000
           VIKING_SEDR_DATA.IMAGE_TIME    : 1976 JUN 17 01:02:50.177

         ROW =            6
           VIKING_SEDR_DATA.IMAGE_NUMBER  :     25843639
           VIKING_SEDR_DATA.IMAGE_ID      : 169C02
           VIKING_SEDR_DATA.PLATFORM_CLOCK:    119.27000000000000
           VIKING_SEDR_DATA.IMAGE_TIME    : 1976 JUN 17 01:02:54.521

         ROW =            7
           VIKING_SEDR_DATA.IMAGE_NUMBER  :     25846934
           VIKING_SEDR_DATA.IMAGE_ID      : 169C03
           VIKING_SEDR_DATA.PLATFORM_CLOCK:    120.14000000000000
           VIKING_SEDR_DATA.IMAGE_TIME    : 1976 JUN 17 05:08:56.263

         ROW =            8
           VIKING_SEDR_DATA.IMAGE_NUMBER  :     25846935
           VIKING_SEDR_DATA.IMAGE_ID      : 169C04
           VIKING_SEDR_DATA.PLATFORM_CLOCK:    119.52000000000000
           VIKING_SEDR_DATA.IMAGE_TIME    : 1976 JUN 17 05:09:00.607

         ROW =            9
           VIKING_SEDR_DATA.IMAGE_NUMBER  :     25848026
           VIKING_SEDR_DATA.IMAGE_ID      : 169C05
           VIKING_SEDR_DATA.PLATFORM_CLOCK:    120.14000000000000
           VIKING_SEDR_DATA.IMAGE_TIME    : 1976 JUN 17 06:30:28.424

         ROW =           10
           VIKING_SEDR_DATA.IMAGE_NUMBER  :     25848030
           VIKING_SEDR_DATA.IMAGE_ID      : 169C09
           VIKING_SEDR_DATA.PLATFORM_CLOCK:    120.14000000000000
           VIKING_SEDR_DATA.IMAGE_TIME    : 1976 JUN 17 06:30:46.174

         ROW =           11
           VIKING_SEDR_DATA.IMAGE_NUMBER  :     25848032
           VIKING_SEDR_DATA.IMAGE_ID      : 169C11
           VIKING_SEDR_DATA.PLATFORM_CLOCK:    120.14000000000000
           VIKING_SEDR_DATA.IMAGE_TIME    : 1976 JUN 17 06:30:55.168
</PRE>
<h4><a name="Restrictions">Restrictions</a></h4>
<PRE>
     1)  Currently, column names are the only supported expressions.
</PRE>
<h4><a name="Literature_References">Literature_References</a></h4>
<PRE>
     None.
</PRE>
<h4><a name="Author_and_Institution">Author_and_Institution</a></h4>
<PRE>
     N.J. Bachman       (JPL)
     J. Diaz del Rio    (ODC Space)
</PRE>
<h4><a name="Version">Version</a></h4>
<PRE>
    SPICELIB Version 1.1.0, 06-JUL-2021 (JDR)

        Added IMPLICIT NONE statement.

        Edited the header to comply with NAIF standard. Added complete
        code example based on existing fragment.

    SPICELIB Version 1.0.0, 19-DEC-1995 (NJB)</PRE>
<h4>Link to routine EKPSEL source file <a href='../../../src/spicelib/ekpsel.f'>ekpsel.f</a> </h4>

      </td>
    </tr>
  </tbody>
</table>

   <pre>Fri Dec 31 18:36:19 2021</pre>

</body>
</html>

