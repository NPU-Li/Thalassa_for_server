
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<HTML>

<HEAD>
   <TITLE>phaseq</TITLE>
</HEAD>

<BODY style="color: rgb(0, 0, 0); background-color: rgb(255, 255, 255);">
<A name="TOP"></A>

<table style="text-align: left; margin-left: auto; margin-right: auto; width: 800px;"
 border="0" cellpadding="5" cellspacing="2">
  <tbody>
    <tr><td>
<div align="center">
Index of Functions: 
<A HREF="index.html#A">A</A>&nbsp;
<A HREF="index.html#B">B</A>&nbsp;
<A HREF="index.html#C">C</A>&nbsp;
<A HREF="index.html#D">D</A>&nbsp;
<A HREF="index.html#E">E</A>&nbsp;
<A HREF="index.html#F">F</A>&nbsp;
<A HREF="index.html#G">G</A>&nbsp;
<A HREF="index.html#H">H</A>&nbsp;
<A HREF="index.html#I">I</A>&nbsp;
<A HREF="index.html#J">J</A>&nbsp;
<A HREF="index.html#K">K</A>&nbsp;
<A HREF="index.html#L">L</A>&nbsp;
<A HREF="index.html#M">M</A>&nbsp;
<A HREF="index.html#N">N</A>&nbsp;
<A HREF="index.html#O">O</A>&nbsp;
<A HREF="index.html#P">P</A>&nbsp;
<A HREF="index.html#Q">Q</A>&nbsp;
<A HREF="index.html#R">R</A>&nbsp;
<A HREF="index.html#S">S</A>&nbsp;
<A HREF="index.html#T">T</A>&nbsp;
<A HREF="index.html#U">U</A>&nbsp;
<A HREF="index.html#V">V</A>&nbsp;
<A HREF="index.html#W">W</A>&nbsp;
<A HREF="index.html#X">X</A>&nbsp;
</div>
</td></tr>

    <tr>
      <td style="background-color: rgb(153, 153, 153); vertical-align: middle; text-align: center;">
      <div align="right"> 
      <small><small><a href="index.html">Index Page</a></small></small>
      </div>
      <b>phaseq</b></td>
    </tr>
    

    <tr>
      <td style="vertical-align: top;">

       <br>
       <div align="left"><b>Table of contents</b></div>
       <table style="text-align: left; width: 60%; margin-left: auto; margin-right: auto;"
       border="0" cellspacing="2" cellpadding="2">
        <tbody>
          <tr>
            <td style="width: 33%; text-align: center;">
              <a href="#Procedure">Procedure<br></a>
              <a href="#Abstract">Abstract<br></a>
              <a href="#Required_Reading">Required_Reading<br></a>
              <a href="#Keywords">Keywords<br></a>
              <a href="#Declarations">Declarations<br></a>
              <a href="#Brief_I/O">Brief_I/O<br></a>

              </td>
              <td style="vertical-align: top; width: 33%; text-align: center;">              <a href="#Detailed_Input">Detailed_Input<br></a>
              <a href="#Detailed_Output">Detailed_Output<br></a>
              <a href="#Parameters">Parameters<br></a>
              <a href="#Exceptions">Exceptions<br></a>
              <a href="#Files">Files<br></a>
              <a href="#Particulars">Particulars<br></a>

              </td>
              <td style="vertical-align: top; width: 33%; text-align: center;">              <big><b><a href="#Examples">Examples<br></a></b></big>
              <a href="#Restrictions">Restrictions<br></a>
              <a href="#Literature_References">Literature_References<br></a>
              <a href="#Author_and_Institution">Author_and_Institution<br></a>
              <a href="#Version">Version<br></a>
            </td>
          </tr>
        </tbody>
</table>
<hr>

<h4><a name="Procedure">Procedure</a></h4>
<PRE>
     PHASEQ ( Phase angle quantity between bodies centers )

     DOUBLE PRECISION FUNCTION PHASEQ ( ET,     TARGET, ILLMN,
    .                                   OBSRVR, ABCORR )
</PRE>
<h4><a name="Abstract">Abstract</a></h4>
<PRE>
     Compute the apparent phase angle for a target, observer,
     illuminator set of ephemeris objects.
</PRE>
<h4><a name="Required_Reading">Required_Reading</a></h4>
<PRE>
     None.
</PRE>
<h4><a name="Keywords">Keywords</a></h4>
<PRE>
     EPHEMERIS
     GEOMETRY
     PHASE ANGLE
     SEARCH
</PRE>
<h4><a name="Declarations">Declarations</a></h4>
<PRE>
     IMPLICIT NONE

     INCLUDE               'zzabcorr.inc'
     INCLUDE               'zzctr.inc'

     DOUBLE PRECISION      ET
     CHARACTER*(*)         TARGET
     CHARACTER*(*)         ILLMN
     CHARACTER*(*)         OBSRVR
     CHARACTER*(*)         ABCORR
</PRE>
<h4><a name="Brief_I/O">Brief_I/O</a></h4>
<PRE>
     VARIABLE  I/O  DESCRIPTION
     --------  ---  --------------------------------------------------
     ET         I   Ephemeris seconds past J2000 TDB.
     TARGET     I   Target body name.
     ILLMN      I   Illuminating body name.
     OBSRVR     I   Observer body.
     ABCORR     I   Aberration correction flag.

     The function returns the value of phase angle.
</PRE>
<h4><a name="Detailed_Input">Detailed_Input</a></h4>
<PRE>
     ET       is the time in ephemeris seconds past J2000 TDB at which
              to compute the phase angle.

     TARGET   is the name of the target body. Optionally, you may
              supply a string containing the integer ID code
              for the object. For example both 'MOON' and '301'
              are legitimate strings that indicate the Moon is the
              target body. The TARGET string lack sensitivity to
              case, leading and trailing blanks.

     ILLMN    is the name of the illuminating body. Optionally, you may
              supply a string containing the integer ID code
              for the object. For example both 'SUN' and '10'
              are legitimate strings that indicate the sun is the
              illuminating body. The ILLMN string lack sensitivity
              to case, leading and trailing blanks.

              In most cases, ILLMN is the sun.

     OBSRVR   is the name of the observer body. Optionally, you may
              supply a string containing the integer ID code
              for the object. For example both 'MOON' and '301'
              are legitimate strings that indicate the Moon is the
              observer body. The OBSRVR string lack sensitivity
              to case, leading and trailing blanks.

     ABCORR   is the string description of the aberration corrections
              to apply to the state evaluations to account for one-way
              light time and stellar aberration. The ABCORR string lack
              sensitivity to case, leading and trailing blanks.

              This routine accepts only reception mode aberration
              corrections. See the header of <a href="spkezr.html">SPKEZR</a> for a detailed
              description of the aberration correction options.
              For convenience, the appropriate aberration options are
              listed below:

                 'NONE'     Apply no correction. Returns the &quot;true&quot;
                            geometric state.

                 'LT'       &quot;Reception&quot; case: correct for
                            one-way light time using a Newtonian
                            formulation.

                 'LT+S'     &quot;Reception&quot; case: correct for
                            one-way light time and stellar
                            aberration using a Newtonian
                            formulation.

                 'CN'       &quot;Reception&quot; case: converged
                            Newtonian light time correction.

                 'CN+S'     &quot;Reception&quot; case: converged
                            Newtonian light time and stellar
                            aberration corrections.
</PRE>
<h4><a name="Detailed_Output">Detailed_Output</a></h4>
<PRE>
     The function returns the optionally light-time corrected phase
     angle between TARGET and ILLMN as observed from OBSRVR.

     The range of the phase angle is [0, pi].
</PRE>
<h4><a name="Parameters">Parameters</a></h4>
<PRE>
     None.
</PRE>
<h4><a name="Exceptions">Exceptions</a></h4>
<PRE>
     1)  If the body name to SPICE ID look-up fails for any of the
         TARGET, ILLMN, or OBSRVR names, the error
         SPICE(IDCODENOTFOUND) is signaled.

     2)  If the aberration correct, ABCORR, indicates a transmission
         based correction, the error SPICE(INVALIDOPTION) is signaled.

     3)  If the TARGET, ILLMN, and OBSRVR are not unique, the error
         SPICE(BODIESNOTDISTINCT) is signaled.
</PRE>
<h4><a name="Files">Files</a></h4>
<PRE>
   Appropriate kernels must be loaded by the calling program before
   this routine is called.

   The following data are required:

   -  SPK data: ephemeris data for the observer, illuminator, and
      target must be loaded. If aberration corrections are used,
      the states of the ephemeris bodies relative to the solar 
      system barycenter must be calculable from the available
      ephemeris data. Typically ephemeris data are made
      available by loading one or more SPK files using <a href="furnsh.html">FURNSH</a>.

   The following data may be required:

   -  Frame data: if a frame definition not built into SPICE is
      required, that definition must be available in the kernel 
      pool. Typically frame definitions are supplied by loading a
      frame kernel using <a href="furnsh.html">FURNSH</a>.

   -  Orientation data: if a CK based frame is used in this routine's
      state computation, then at least one CK and corresponding SCLK
      kernel is required. If dynamic frames are used, additional
      SPK, PCK, CK, or SCLK kernels may be required.
</PRE>
<h4><a name="Particulars">Particulars</a></h4>
<PRE>
     This routine returns the phase angle using the location of the
     bodies (if point objects) or the center of the bodies (if finite
     bodies).



                       ILLMN     OBSRVR
       ILLMN as seen      ^       /
       from TARGET at     |      /
       ET - LT.           |     /
                         &gt;|..../&lt; phase angle
                          |   /
                        . |  /
                      .   | /
                     .    |v        TARGET as seen from OBSRVR
               SEP   .  TARGET      at ET
                      .  /
                        /
                       v



        <a href="pi.html">PI</a> = SEP + PHASE

        so

        PHASE = <a href="pi.html">PI</a> - SEP
</PRE>
<h4><a name="Examples">Examples</a></h4>
<PRE>
     The numerical results shown for this example may differ across
     platforms. The results depend on the SPICE kernels used as
     input, the compiler and supporting libraries, and the machine
     specific arithmetic implementation.

     1) Determine the time windows from December 1, 2006 UTC to
        January 31, 2007 UTC for which the sun-moon-earth configuration
        phase angle satisfies the relation conditions with respect to a
        reference value of 0.57598845 radians (the phase angle at
        January 1, 2007 00:00:00.000 UTC, 33.001707 degrees). Also
        determine the time windows corresponding to the local maximum
        and minimum phase angles, and the absolute maximum and minimum
        phase angles during the search interval. The configuration
        defines the Sun as the illuminator, the Moon as the target, and
        the Earth as the observer.

        Use the meta-kernel shown below to load the required SPICE
        kernels.


           KPL/MK

           File name: phaseq_ex1.tm

           This meta-kernel is intended to support operation of SPICE
           example programs. The kernels shown here should not be
           assumed to contain adequate or correct versions of data
           required by SPICE-based user applications.

           In order for an application to use this meta-kernel, the
           kernels referenced here must be present in the user's
           current working directory.

           The names and contents of the kernels referenced
           by this meta-kernel are as follows:

              File name                     Contents
              ---------                     --------
              de421.bsp                     Planetary ephemeris
              pck00009.tpc                  Planet orientation and
                                            radii
              naif0009.tls                  Leapseconds

           \begindata

              KERNELS_TO_LOAD = ( 'de421.bsp',
                                  'pck00009.tpc',
                                  'naif0009.tls'  )

           \begintext

           End of meta-kernel


        Example code begins here.


              PROGRAM PHASEQ_EX1
              IMPLICIT NONE

        C
        C     Include GF parameter declarations:
        C
              INCLUDE 'gf.inc'

        C
        C     SPICELIB functions
        C
              DOUBLE PRECISION      <a href="spd.html">SPD</a>
              DOUBLE PRECISION      <b>PHASEQ</b>

              INTEGER               <a href="wncard.html">WNCARD</a>

        C
        C     Local parameters
        C
              INTEGER               LBCELL
              PARAMETER           ( LBCELL = -5 )

        C
        C     Use the parameter MAXWIN for both the result window size
        C     and the workspace size.
        C
              INTEGER               MAXWIN
              PARAMETER           ( MAXWIN = 1000 )

        C
        C     Length of strings:
        C
              INTEGER               TIMLEN
              PARAMETER           ( TIMLEN = 26 )

              INTEGER               NLOOPS
              PARAMETER           ( NLOOPS = 7 )

        C
        C     Local variables
        C
              CHARACTER*(TIMLEN)    RELATE (NLOOPS)
              CHARACTER*(6)         ABCORR
              CHARACTER*(6)         ILLMN
              CHARACTER*(6)         OBSRVR
              CHARACTER*(6)         TARGET
              CHARACTER*(TIMLEN)    TIMSTR

              DOUBLE PRECISION      CNFINE ( LBCELL : 2 )
              DOUBLE PRECISION      RESULT ( LBCELL : MAXWIN )
              DOUBLE PRECISION      WORK   ( LBCELL : MAXWIN, NWPA )
              DOUBLE PRECISION      ADJUST
              DOUBLE PRECISION      ET0
              DOUBLE PRECISION      ET1
              DOUBLE PRECISION      FINISH
              DOUBLE PRECISION      PHASE
              DOUBLE PRECISION      REFVAL
              DOUBLE PRECISION      START
              DOUBLE PRECISION      STEP

              INTEGER               I
              INTEGER               J


        C
        C     The relation values for the search.
        C
              DATA                  RELATE / '=',
             .                               '&lt;',
             .                               '&gt;',
             .                               'LOCMIN',
             .                               'ABSMIN',
             .                               'LOCMAX',
             .                               'ABSMAX'  /


        C
        C     Load kernels.
        C
              CALL <a href="furnsh.html">FURNSH</a> ( 'phaseq_ex1.tm' )

        C
        C     Initialize windows.
        C
              CALL <a href="ssized.html">SSIZED</a> ( MAXWIN, RESULT )
              CALL <a href="ssized.html">SSIZED</a> ( 2,      CNFINE )

        C
        C     Store the time bounds of our search interval in
        C     the confinement window.
        C
              CALL <a href="str2et.html">STR2ET</a> ( '2006 DEC 01', ET0 )
              CALL <a href="str2et.html">STR2ET</a> ( '2007 JAN 31', ET1 )

              CALL <a href="wninsd.html">WNINSD</a> ( ET0, ET1, CNFINE )

        C
        C     Search using a step size of 1 day (in units of seconds).
        C     The reference value is 0.57598845. We're not using the
        C     adjustment feature, so we set ADJUST to zero.
        C
              STEP   = <a href="spd.html">SPD</a>()
              REFVAL = 0.57598845D0
              ADJUST = 0.D0

        C
        C     Define the values for target, observer, illuminator, and
        C     aberration correction.
        C
              TARGET = 'MOON'
              ILLMN  = 'SUN'
              ABCORR = 'LT+S'
              OBSRVR = 'EARTH'

              DO J=1, NLOOPS

                 WRITE(*,*) 'Relation condition: ', RELATE(J)

        C
        C        Perform the search. The SPICE window RESULT contains
        C        the set of times when the condition is met.
        C
                 CALL <a href="gfpa.html">GFPA</a> (  TARGET,    ILLMN,  ABCORR, OBSRVR,
             .                RELATE(J), REFVAL, ADJUST, STEP,
             .                CNFINE,    MAXWIN, NWPA,   WORK,
             .                RESULT )

        C
        C        Display the results.
        C
                 IF ( <a href="wncard.html">WNCARD</a>(RESULT) .EQ. 0 ) THEN

                    WRITE (*, '(A)') 'Result window is empty.'

                 ELSE

                    DO I = 1, <a href="wncard.html">WNCARD</a>(RESULT)
        C
        C              Fetch the endpoints of the Ith interval
        C              of the result window.
        C
                       CALL <a href="wnfetd.html">WNFETD</a> ( RESULT, I, START, FINISH )

                       PHASE = <b>PHASEQ</b>( START, TARGET, ILLMN, OBSRVR,
             .                         ABCORR )
                       CALL <a href="timout.html">TIMOUT</a> ( START,
             .                       'YYYY-MON-DD HR:MN:SC.###',
             .                       TIMSTR                          )

                       WRITE (*, '(2X,A,F16.9)') 'Start time = '
             .                               //   TIMSTR, PHASE


                       PHASE = <b>PHASEQ</b>( FINISH, TARGET, ILLMN, OBSRVR,
             .                         ABCORR )
                       CALL <a href="timout.html">TIMOUT</a> ( FINISH,
             .                       'YYYY-MON-DD HR:MN:SC.###',
             .                       TIMSTR                          )

                       WRITE (*, '(2X,A,F16.9)') 'Stop time  = '
             .                                //  TIMSTR, PHASE

                    END DO

                 END IF

                 WRITE(*,*) ' '

              END DO

              END


        When this program was executed on a Mac/Intel/gfortran/64-bit
        platform, the output was:


         Relation condition: =
          Start time = 2006-DEC-02 13:31:34.414       0.575988450
          Stop time  = 2006-DEC-02 13:31:34.414       0.575988450
          Start time = 2006-DEC-07 14:07:55.470       0.575988450
          Stop time  = 2006-DEC-07 14:07:55.470       0.575988450
          Start time = 2006-DEC-31 23:59:59.997       0.575988450
          Stop time  = 2006-DEC-31 23:59:59.997       0.575988450
          Start time = 2007-JAN-06 08:16:25.512       0.575988450
          Stop time  = 2007-JAN-06 08:16:25.512       0.575988450
          Start time = 2007-JAN-30 11:41:32.557       0.575988450
          Stop time  = 2007-JAN-30 11:41:32.557       0.575988450

         Relation condition: &lt;
          Start time = 2006-DEC-02 13:31:34.414       0.575988450
          Stop time  = 2006-DEC-07 14:07:55.470       0.575988450
          Start time = 2006-DEC-31 23:59:59.997       0.575988450
          Stop time  = 2007-JAN-06 08:16:25.512       0.575988450
          Start time = 2007-JAN-30 11:41:32.557       0.575988450
          Stop time  = 2007-JAN-31 00:00:00.000       0.468279091

         Relation condition: &gt;
          Start time = 2006-DEC-01 00:00:00.000       0.940714974
          Stop time  = 2006-DEC-02 13:31:34.414       0.575988450
          Start time = 2006-DEC-07 14:07:55.470       0.575988450
          Stop time  = 2006-DEC-31 23:59:59.997       0.575988450
          Start time = 2007-JAN-06 08:16:25.512       0.575988450
          Stop time  = 2007-JAN-30 11:41:32.557       0.575988450

         Relation condition: LOCMIN
          Start time = 2006-DEC-05 00:16:50.317       0.086121423
          Stop time  = 2006-DEC-05 00:16:50.317       0.086121423
          Start time = 2007-JAN-03 14:18:31.977       0.079899769
          Stop time  = 2007-JAN-03 14:18:31.977       0.079899769

         Relation condition: ABSMIN
          Start time = 2007-JAN-03 14:18:31.977       0.079899769
          Stop time  = 2007-JAN-03 14:18:31.977       0.079899769

         Relation condition: LOCMAX
          Start time = 2006-DEC-20 14:09:10.392       3.055062862
          Stop time  = 2006-DEC-20 14:09:10.392       3.055062862
          Start time = 2007-JAN-19 04:27:54.600       3.074603891
          Stop time  = 2007-JAN-19 04:27:54.600       3.074603891

         Relation condition: ABSMAX
          Start time = 2007-JAN-19 04:27:54.600       3.074603891
          Stop time  = 2007-JAN-19 04:27:54.600       3.074603891
</PRE>
<h4><a name="Restrictions">Restrictions</a></h4>
<PRE>
     None.
</PRE>
<h4><a name="Literature_References">Literature_References</a></h4>
<PRE>
     None.
</PRE>
<h4><a name="Author_and_Institution">Author_and_Institution</a></h4>
<PRE>
     J. Diaz del Rio    (ODC Space)
     B.V. Semenov       (JPL)
     E.D. Wright        (JPL)
</PRE>
<h4><a name="Version">Version</a></h4>
<PRE>
    SPICELIB Version 1.0.1, 31-AUG-2021 (JDR) (EDW)

        Edited the header to comply with NAIF standards.

        Fixed typos in the Header. Renamed example's meta-kernel.
        Removed reference to private routine ZZGFPAQ from $Particulars
        section.

    SPICELIB Version 1.0.0, 27-MAR-2014 (EDW) (BVS)</PRE>
<h4>Link to routine PHASEQ source file <a href='../../../src/spicelib/phaseq.f'>phaseq.f</a> </h4>

      </td>
    </tr>
  </tbody>
</table>

   <pre>Fri Dec 31 18:36:38 2021</pre>

</body>
</html>

